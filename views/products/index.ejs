<%- include('../partials/header') %>

<div class="container my-5">
  <h1 class="mb-4">Products</h1>

  <!-- Search / Filter -->
  <form method="GET" action="/products" class="row g-3 mb-4">
    <div class="col-md-4">
      <input type="text" name="q" value="<%= filterQ %>" class="form-control" placeholder="Search name">
    </div>
    <div class="col-md-4">
      <select name="supplier" class="form-select">
        <option value="">--All--</option>
        <% suppliers.forEach(s => { %>
          <option value="<%= s._id %>"><%= s.name %></option>
        <% }) %>
      </select>
    </div>
    <div class="col-md-4">
      <button class="btn btn-primary w-100">Search</button>
    </div>
  </form>

  <% if(currentUser){ %>
    <a href="/products/new" class="btn btn-success mb-3">New Product</a>
  <% } %>

  <!-- Product List Table -->
  <ul class="list-group">
    <!-- Header row -->
    <li class="list-group-item d-flex fw-bold">
      <span class="flex-grow-1" style="max-width: 150px;">Name</span>
      <span style="width: 80px;">Price</span>
      <span style="width: 60px;">Qty</span>
      <span class="flex-grow-1" style="max-width: 150px;">Supplier</span>
      <% if(currentUser){ %>
        <span>Actions</span>
      <% } %>
    </li>

    <% products.forEach(p => { %>
      <li class="list-group-item d-flex align-items-center">
        <span class="flex-grow-1" style="max-width: 150px;"><%= p.name %></span>
        <span style="width: 80px;"><%= p.price %></span>
        <span style="width: 60px;"><%= p.quantity %></span>
        <span class="flex-grow-1" style="max-width: 150px;"><%= p.supplier ? p.supplier.name : '' %></span>
        <% if(currentUser){ %>
          <span class="d-flex gap-2">
            <a href="/products/<%= p._id %>/edit" class="btn btn-sm btn-warning">Edit</a>
            <form action="/products/<%= p._id %>?_method=DELETE" method="POST" class="d-inline">
              <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>
          </span>
        <% } %>
      </li>
    <% }) %>
  </ul>
</div>

<%- include('../partials/footer') %>
